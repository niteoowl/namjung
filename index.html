<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부산남중 알리미 - 홈</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 기본 폰트 및 다크 모드 배경 설정 */
        body {
            font-family: "Inter", sans-serif;
            background-color: #1a1a1a; /* 어두운 배경색 */
            color: #e2e8f0; /* 밝은 글자색 */
            line-height: 1.6;
            padding-bottom: 60px; /* 하단 내비게이션 바 높이만큼 여백 추가 */
            scroll-behavior: smooth; /* 부드러운 스크롤 효과 추가 */
        }
        /* 섹션 숨김/보기를 위한 스타일 */
        .hidden {
            display: none;
        }
        /* 하단 고정 내비게이션 바 스타일 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2a2a2a; /* 어두운 배경 */
            color: #e2e8f0; /* 밝은 글자색 */
            z-index: 10; /* 다른 요소 위에 표시 */
            border-top: 1px solid #4a5568; /* 상단에 회색 테두리 추가 */
        }
        .bottom-nav ul {
            display: flex;
            justify-content: space-around; /* 항목 간 간격 균등 분배 */
            padding: 0;
            margin: 0;
            list-style: none;
        }
        .bottom-nav li {
            flex-grow: 1; /* 항목이 공간을 채우도록 함 */
            text-align: center;
        }
        .bottom-nav a {
            display: block; /* 링크 영역 전체 클릭 가능 */
            padding: 8px 0; /* 패딩 줄임 */
            text-decoration: none;
            color: #e2e8f0; /* 밝은 글자색 */
            font-size: 0.7rem; /* 글자 크기 줄임 */
            transition: color 0.3s ease; /* 색상 변화 애니메이션 */
        }
        /* 모든 링크 호버 시 파란색 */
        .bottom-nav a:hover {
            color: #63b3ed; /* 호버 시 밝은 파란색 */
            font-weight: bold;
        }
        /* 홈 링크만 활성(active) 상태일 때 파란색 */
        .bottom-nav a.active[data-section="home-section"] {
            color: #63b3ed; /* 활성 시 밝은 파란색 */
            font-weight: bold;
        }

         /* 아이콘 스타일 */
        .nav-icon {
            display: block;
            margin: 0 auto 2px; /* 아이콘 위/아래 여백 줄임 */
            width: 20px; /* 아이콘 크기 줄임 */
            height: 20px;
            fill: currentColor; /* 글자색 따라가도록 설정 */
        }

        /* 카드 스타일 */
        .card {
            background-color: #2a2a2a; /* 어두운 배경 */
            padding: 16px; /* 패딩 줄임 */
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); /* 그림자 진하게 */
            color: #e2e8f0; /* 밝은 글자색 */
        }

        /* 초기 설정 프롬프트 스타일 */
        .initial-prompt {
            background-color: #2a2a2a; /* 어두운 배경 */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            color: #e2e8f0;
        }
         .initial-prompt label {
             color: #e2e8f0; /* 밝은 글자색 */
         }
         .initial-prompt input[type="number"] {
             background-color: #3a3a3a; /* 더 어두운 입력 필드 배경 */
             border-color: #3a3a3a; /* 어두운 테두리 */
             color: #e2e8f0; /* 밝은 글자색 */
         }
         .initial-prompt input[type="number"]:focus {
             ring-color: #63b3ed; /* 포커스 시 밝은 파란색 테두리 */
         }
         .initial-prompt button {
             background-color: #ffffff; /* 밝은 파란색 버튼 */
             color: #1a202c; /* 어두운 글자색 */
             font-weight: bold;
         }
         .initial-prompt button:hover {
             background-color: #EDEDED; /* 호버 시 더 진한 파란색 */
         }

         /* 학사일정 섹션 스타일 */
        .academic-calendar .event-item {
            border-bottom: 1px solid #4a5568; /* 어두운 구분선 */
            padding-bottom: 12px;
            margin-bottom: 12px;
        }
        .academic-calendar .event-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .academic-calendar .event-item .event-date {
            font-size: 0.8rem;
            color: #a0aec0; /* 연한 글자색 */
            margin-bottom: 4px;
        }
        .academic-calendar .event-item .event-name {
            color: #e2e8f0; /* 밝은 글자색 */
            font-weight: bold;
        }


         /* 날짜 표시 컨테이너 스타일 */
         .date-nav-container {
             display: flex; /* 플렉스 박스 사용 */
             align-items: center; /* 세로 중앙 정렬 */
             justify-content: space-between; /* 항목 간 공간 분배 (날짜와 버튼 컨테이너) */
             margin-bottom: 24px; /* 하단 여백 */
         }

         /* 날짜 변경 버튼 컨테이너 스타일 */
         .date-buttons-container {
             display: flex; /* 플렉스 박스 사용 */
             align-items: center; /* 세로 중앙 정렬 */
             gap: 5px; /* 버튼 간 간격 */
         }


         /* 날짜 변경 버튼 스타일 */
         .date-nav-button {
             background: none; /* 배경 없음 */
             border: none; /* 테두리 없음 */
             color: #e2e8f0; /* 밝은 글자색 */
             font-size: 1.5rem; /* 아이콘 크기 */
             cursor: pointer;
             padding: 0 5px; /* 좌우 패딩 줄임 */
             transition: color 0.3s ease;
         }
         .date-nav-button:hover {
             color: #63b3ed; /* 호버 시 밝은 파란색 */
         }

         /* 날짜 표시 스타일 */
         .date-display {
             font-size: 1.1rem; /* 글자 크기 */
             color: #cbd5e0; /* 연한 글자색 */
             /* margin: 0 15px; 이전 중앙 정렬용 마진 제거 */
             min-width: 150px; /* 최소 너비 설정 (날짜 길이에 따라 조절) */
             /* text-align: center; 이전 중앙 정렬용 텍스트 정렬 제거 */
         }

         /* 홈 섹션의 시간표/급식 요약 스타일 */
         .summary-card {
             background-color: #2a2a2a;
             padding: 12px; /* 패딩 줄임 */
             border-radius: 8px;
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* 그림자 연하게 */
         }
         .summary-card h3 {
             font-size: 1rem; /* 글자 크기 줄임 */
             font-weight: bold;
             margin-bottom: 6px; /* 여백 줄임 */
             color: #e2e8f0;
         }
         .summary-card .content {
             font-size: 0.8rem; /* 글자 크기 줄임 */
             color: #cbd5e0;
         }
         .summary-card .link {
             font-size: 0.8rem;
             color: #90cdf4;
             text-decoration: underline;
             cursor: pointer;
             display: block;
             margin-top: 6px;
         }

         /* 학사일정 달력 스타일 */
         .calendar-grid {
             display: grid;
             grid-template-columns: repeat(7, 1fr); /* 7일 */
             gap: 5px; /* 셀 간 간격 */
             text-align: center;
             font-size: 0.9rem;
         }
         .calendar-header {
             font-weight: bold;
             color: #90cdf4; /* 요일 색상 */
             padding-bottom: 8px;
             border-bottom: 1px solid #4a5568;
             margin-bottom: 5px;
         }
         .calendar-day {
             padding: 5px 2px; /* 셀 패딩 */
             border-radius: 4px;
             min-height: 50px; /* 셀 최소 높이 */
             position: relative; /* 이벤트 표시를 위해 */
             overflow: hidden; /* 내용 넘칠 경우 숨김 */
             background-color: #3a3a3a; /* 기본 셀 배경 */
             color: #cbd5e0; /* 기본 글자색 */
             cursor: pointer; /* 툴팁 표시를 위해 커서 변경 */
         }
         .calendar-day.current-month {
             background-color: #2a2a2a; /* 해당 월 셀 배경 */
             color: #e2e8f0; /* 해당 월 글자색 */
         }
         .calendar-day.has-event {
             background-color: #4a5568; /* 이벤트 있는 날 배경 */
             border: 1px solid #63b3ed; /* 이벤트 있는 날 테두리 */
         }
         .calendar-day .day-number {
             font-size: 1em;
             font-weight: bold;
             margin-bottom: 2px;
         }
         .calendar-day .event-indicator {
             font-size: 0.6em;
             color: #90cdf4; /* 이벤트 표시 색상 */
             white-space: nowrap; /* 줄바꿈 방지 */
             overflow: hidden;
             text-overflow: ellipsis; /* 넘치는 텍스트 ... 처리 */
             display: block; /* 블록 요소로 만들어 전체 너비 사용 */
         }
         /* 툴팁 스타일 (이벤트 상세 정보 표시용) */
         .event-tooltip {
             position: absolute;
             bottom: 100%; /* 셀 위에 표시 */
             left: 50%;
             transform: translateX(-50%);
             background-color: #1a1a1a;
             color: #e2e8f0;
             padding: 8px;
             border-radius: 4px;
             white-space: normal; /* 툴팁 내 줄바꿈 허용 */
             width: 150px; /* 툴팁 너비 */
             z-index: 20; /* 다른 요소 위에 표시 */
             box-shadow: 0 2px 5px rgba(0,0,0,0.5);
             display: none; /* 기본 숨김 */
             margin-bottom: 5px; /* 셀과의 간격 */
             text-align: left;
             font-size: 0.8rem;
         }
          .calendar-day:hover .event-tooltip {
             display: block; /* 호버 시 표시 */
         }
         .event-tooltip .tooltip-date {
             font-weight: bold;
             margin-bottom: 4px;
             color: #90cdf4;
         }
         .event-tooltip .tooltip-event {
             margin-bottom: 2px;
         }
         .event-tooltip .tooltip-event:last-child {
             margin-bottom: 0;
         }

         /* 보기 전환 버튼 스타일 */
         .view-toggle-button {
             background: none;
             border: 1px solid #4a5568;
             color: #e2e8f0;
             padding: 4px 8px;
             border-radius: 4px;
             font-size: 0.8rem;
             cursor: pointer;
             transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .view-toggle-button:hover {
             background-color: #3a3a3a;
             border-color: #63b3ed;
         }

        /* 달력 월 네비게이션 스타일 */
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav-button {
            background: none;
            border: none;
            color: #e2e8f0;
            font-size: 1.2rem; /* 아이콘 크기에 맞게 조절 */
            cursor: pointer;
            padding: 5px; /* 패딩 조절 */
            transition: color 0.3s ease;
            display: flex; /* SVG 중앙 정렬 */
            align-items: center;
            justify-content: center;
        }
        .calendar-nav-button:hover {
            color: #63b3ed;
        }
         .calendar-nav-button svg {
             width: 20px; /* SVG 아이콘 크기 */
             height: 20px;
         }


        .calendar-month-year {
            font-size: 1.1rem;
            font-weight: bold;
            color: #e2e8f0;
        }

        /* 모달 배경 스타일 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* 어두운 배경 */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50; /* 다른 요소 위에 표시 */
        }

        /* 모달 내용 스타일 */
        .modal-content {
            background-color: #2a2a2a; /* 어두운 배경 */
            padding: 24px; /* 패딩 증가 */
            border-radius: 12px; /* 모서리 둥글게 */
            color: #e2e8f0;
            width: 90%; /* 너비 설정 */
            max-width: 500px; /* 최대 너비 설정 */
            max-height: 80%; /* 최대 높이 설정 */
            overflow-y: auto; /* 내용이 넘치면 스크롤 */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5); /* 그림자 진하게 */
            border: 1px solid #4a5568; /* 테두리 추가 */
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px; /* 여백 증가 */
            border-bottom: 1px solid #4a5568;
            padding-bottom: 12px; /* 패딩 증가 */
        }

        .modal-header h3 {
            font-size: 1.3rem; /* 글자 크기 증가 */
            font-weight: bold;
            color: #e2e8f0;
        }

        .modal-close-button {
            background: none;
            border: none;
            color: #e2e8f0;
            font-size: 1.8rem; /* 닫기 버튼 크기 증가 */
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .modal-close-button:hover {
             color: #63b3ed;
        }

        .modal-event-item {
            margin-bottom: 15px; /* 여백 증가 */
            padding-bottom: 15px; /* 패딩 증가 */
            border-bottom: 1px dashed #4a5568; /* 점선 구분선 */
        }
        .modal-event-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .modal-event-date {
            font-size: 1rem; /* 글자 크기 증가 */
            color: #a0aec0;
            margin-bottom: 6px; /* 여백 증가 */
        }

         .modal-event-name {
            font-size: 1.1rem; /* 글자 크기 증가 */
            color: #e2e8f0;
            font-weight: bold;
            word-break: break-word; /* 긴 단어 잘림 방지 */
         }


    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-[#0e1317] text-white p-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">부산남중학교</h1>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 cursor-pointer hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" onclick="location.reload();">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.582m-15.356-2A8.001 8.001 0 0019.418 15m0 0H15"></path>
        </svg>
    </header>

    <main class="container mx-auto mt-4 p-4 flex-grow">

        <section id="initial-setup-prompt" class="initial-prompt hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-200">환영합니다!</h2>
            <p class="text-gray-400 mb-4">시간표와 급식 정보를 자동으로 조회하기 위해 학년과 반을 입력해주세요.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="prompt-grade" class="block text-gray-300 font-bold mb-1">학년</label>
                    <input type="number" id="prompt-grade" min="1" max="6" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 border-gray-600 text-white">
                </div>
                <div>
                    <label for="prompt-classNm" class="block text-gray-300 font-bold mb-1">반</label>
                    <input type="number" id="prompt-classNm" min="1" max="20" class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 border-gray-600 text-white">
                </div>
            </div>
            <button onclick="saveSchoolInfo()" class="bg-gray-900 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out w-full">
                정보 저장 및 시작
            </button>
        </section>

        <section id="home-section" class="content-section">
            <div class="card mb-4 flex justify-between items-center cursor-pointer" onclick="alert('알림 상세 기능은 개발 예정입니다.')">
                <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                    </svg>
                    <span id="dynamic-message">알림이 없습니다.</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </div>

            <div class="date-nav-container">
                <span class="date-display" id="current-date"></span>
                <div class="date-buttons-container">
                     <button class="date-nav-button" id="prev-day-button">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                         </svg>
                     </button>
                     <button class="date-nav-button" id="next-day-button">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                         </svg>
                     </button>
                </div>
                <input type="hidden" id="date" value="">
            </div>


            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="summary-card">
                    <h3 class="text-xl font-semibold mb-2">시간표</h3>
                    <div class="content" id="timetable-summary">
                        주말 에는 시간표 가 없어 요
                    </div>
                    <a href="#school-life-section" class="link" onclick="alert('학교생활 섹션으로 이동 기능은 개발 예정입니다.')">시간표 상세 보기</a>
                </div>

                <div class="summary-card">
                    <h3 class="text-xl font-semibold mb-2">급식</h3>
                    <div class="content" id="meal-summary">
                        등록 된 급식 이 없어 요
                    </div>
                     <a href="#school-life-section" class="link" onclick="alert('학교생활 섹션으로 이동 기능은 개발 예정입니다.')">급식 상세 보기</a>
                </div>
            </div>

            <div class="card mb-6">
                <div class="flex items-center mb-3">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                         <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                    </svg>
                    <h3 class="text-xl font-semibold text-gray-200">오늘의 이용 시설</h3>
                </div>
                <div class="text-gray-400 text-sm" id="calendar-facility-info">
                    주말/공휴일/방학에는 오늘의 이용시설이 표시되지 않습니다.
                </div>
            </div>

            <div class="card academic-calendar">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-xl font-semibold text-gray-200">학사일정</h3>
                    <button id="view-toggle" class="view-toggle-button">목록 보기</button>
                </div>

                <div class="calendar-nav">
                    <button class="calendar-nav-button" id="prev-month-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                        </svg>
                    </button>
                    <span class="calendar-month-year" id="calendar-month-year"></span>
                    <button class="calendar-nav-button" id="next-month-button">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                        </svg>
                    </button>
                </div>

                <div class="event-list space-y-3 hidden" id="academic-calendar-list">
                    <div class="text-gray-400 text-sm">학사일정을 불러오는 중입니다...</div>
                </div>

                 <div id="academic-calendar-view">
                     </div>
            </div>

        </section>

        </main>

    <nav class="bottom-nav">
        <ul>
            <li><a href="/error" class="nav-link active" data-section="home-section">
                <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                </svg>
                홈
            </a></li>
            <li><a href="/error" class="nav-link" data-section="school-life-section">
                 <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2V4a2 2 0 00-2 2v5a2 2 0 002 2h2.586l1.591 1.591a.997.997 0 001.414 0l1.591-1.591H14a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a2 2 0 114 0v1a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm3 1a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h.01a1 1 0 100-2H10zm3 0a1 1 0 000 2h.01a1 1 0 100-2H13z" clip-rule="evenodd"></path>
                </svg>
                학교생활
            </a></li>
            <li><a href="/error" class="nav-link" data-section="community-section">
                 <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.1c-.02-.05-.04-.1-.059-.15L2 14l1.338-3.1c-.02-.05-.04-.1-.059-.15A8.841 8.841 0 012 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
                </svg>
                커뮤니티
            </a></li>
             <li><a href="/error" class="nav-link" data-section="playground-section">
                 <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm-.414 5.586a1 1 0 000-1.414L9.586 10l-3.793-3.793a1 1 0 011.414-1.414L11 8.586l3.793-3.793a1 1 0 011.414 1.414L12.414 10l3.793 3.793a1 1 0 01-1.414 1.414L11 11.414l-3.793 3.793a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                </svg>
                고민상담
            </a></li>
             <li><a href="/error" class="nav-link" data-section="all-section">
                 <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                </svg>
                전체
            </a></li>
            </ul>
    </nav>

    <div id="event-detail-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-date-title"></h3>
                <button class="modal-close-button" id="modal-close-button">&times;</button>
            </div>
            <div id="modal-event-list">
                </div>
        </div>
    </div>


    <script>
        // 모든 콘텐츠 섹션과 내비게이션 링크를 가져옵니다.
        // 홈 섹션과 초기 프롬프트만 남기고 다른 섹션은 제거되었습니다.
        const contentSections = document.querySelectorAll('.content-section'); // 섹션 요소들
        const navLinks = document.querySelectorAll('.nav-link'); // 하단 내비게이션 링크들
        const initialPromptSection = document.getElementById('initial-setup-prompt'); // 초기 설정 프롬프트 섹션
        const homeSection = document.getElementById('home-section'); // 홈 섹션

        const timetableSummaryDiv = document.getElementById('timetable-summary'); // 홈 섹션 시간표 요약
        const mealSummaryDiv = document.getElementById('meal-summary'); // 홈 섹션 급식 요약
        const calendarFacilityInfoDiv = document.getElementById('calendar-facility-info'); // 홈 섹션 캘린더 시설 정보
        const dynamicMessageSpan = document.getElementById('dynamic-message'); // 동적 메시지 표시 요소
        const academicCalendarListDiv = document.getElementById('academic-calendar-list'); // 학사일정 목록 표시 요소
        const academicCalendarViewDiv = document.getElementById('academic-calendar-view'); // 학사일정 달력 표시 요소
        const viewToggleButton = document.getElementById('view-toggle'); // 보기 전환 버튼

        // 달력 월 네비게이션 요소 가져오기 (목록/달력 보기 공용)
        const calendarMonthYearSpan = document.getElementById('calendar-month-year'); // 달력 월/년 표시 요소
        const prevMonthButton = document.getElementById('prev-month-button'); // 이전 달 버튼
        const nextMonthButton = document.getElementById('next-month-button'); // 다음 달 버튼

        // 상세 일정 모달 요소 가져오기
        const eventDetailModal = document.getElementById('event-detail-modal');
        const modalDateTitle = document.getElementById('modal-date-title');
        const modalEventList = document.getElementById('modal-event-list');
        const modalCloseButton = document.getElementById('modal-close-button');


        // 학교생활 섹션 관련 요소는 제거되었습니다.

        const currentDateSpan = document.getElementById('current-date'); // 현재 날짜 표시 요소
        // 날짜 변경 버튼 가져오기 (일별 이동)
        const prevDayButton = document.getElementById('prev-day-button'); // 이전 날짜 버튼
        const nextDayButton = document.getElementById('next-day-button'); // 다음 날짜 버튼

        const dateInput = document.getElementById('date'); // 날짜 저장용 숨겨진 입력 필드

        // 학교생활 섹션 탭 관련 요소는 제거되었습니다.

        // 학년/반 표시 요소는 홈 섹션에 남겨둡니다.
        const displayGradeSpan = document.getElementById('display-grade'); // 학년 표시 요소
        const displayClassNmSpan = document.getElementById('display-classNm'); // 반 표시 요소

        let currentDate = new Date(); // 현재 표시 중인 날짜를 저장할 변수 (일별 이동 기준)
        let currentCalendarMonth = new Date(); // 현재 달력/목록에 표시 중인 월을 저장할 변수 (월별 이동 기준)
        let hasPE = false; // 현재 날짜 시간표에 체육이 있는지 여부

        let dynamicMessages = []; // 현재 날짜에 표시할 메시지 목록
        let currentMessageIndex = 0; // 현재 표시 중인 메시지 인덱스
        let messageInterval = null; // 메시지 전환 타이머

        let currentView = 'calendar'; // 현재 학사일정 보기 상태 ('list' 또는 'calendar') - 기본값을 'calendar'로 변경

        let academicCalendarEvents = []; // 현재 불러온 학사일정 이벤트 데이터를 저장할 배열

        // 페이지 로드 시 실행
        window.onload = function() {
            loadSchoolInfo(); // 저장된 학년/반 정보 불러오기
            // 날짜를 오늘로 설정하고 표시
            currentDate = new Date(); // 페이지 로드 시 현재 날짜로 초기화 (일별)
            currentCalendarMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1); // 달력 월도 현재 월로 초기화 (해당 월의 1일)

            updateDateDisplay(currentDate); // 일별 날짜 표시 업데이트
            setDateInput(currentDate); // 숨겨진 입력 필드 업데이트
            updateCalendarFacilityInfo(currentDate); // 캘린더 시설 정보 업데이트

            showInitialContent(); // 초기 화면 표시 (프롬프트 또는 홈)

            // 이전 날짜 버튼 클릭 이벤트 (일별 이동)
            prevDayButton.addEventListener('click', async () => {
                currentDate.setDate(currentDate.getDate() - 1); // 날짜 하루 감소
                updateDateDisplay(currentDate); // 날짜 표시 업데이트
                setDateInput(currentDate); // 숨겨진 입력 필드 업데이트
                updateCalendarFacilityInfo(currentDate); // 캘린더 시설 정보 업데이트
                await getTimetable(); // 시간표 다시 불러오기 (비동기 대기)
                getMeals(); // 급식 다시 불러오기
                // 일별 이동 시에는 달력 월은 변경하지 않음
                // getAcademicCalendar(); // 학사일정 다시 불러오기 (달력/목록 모두 업데이트) - 주석 처리
                // 시간표 로드 후 updateDynamicMessage가 호출되어 메시지 목록 및 타이머 업데이트
            });

            // 다음 날짜 버튼 클릭 이벤트 (일별 이동)
            nextDayButton.addEventListener('click', async () => {
                currentDate.setDate(currentDate.getDate() + 1); // 날짜 하루 증가
                updateDateDisplay(currentDate); // 날짜 표시 업데이트
                setDateInput(currentDate); // 숨겨진 입력 필드 업데이트
                updateCalendarFacilityInfo(currentDate); // 캘린더 시설 정보 업데이트
                await getTimetable(); // 시간표 다시 불러오기 (비동기 대기)
                getMeals(); // 급식 다시 불러오기
                 // 일별 이동 시에는 달력 월은 변경하지 않음
                // getAcademicCalendar(); // 학사일정 다시 불러오기 (달력/목록 모두 업데이트) - 주석 처리
                // 시간표 로드 후 updateDynamicMessage가 호출되어 메시지 목록 및 타이머 업데이트
            });

             // 이전 달 버튼 클릭 이벤트 (월별 이동)
             if (prevMonthButton) {
                 prevMonthButton.addEventListener('click', () => {
                     currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() - 1); // 달력 월 한 달 감소
                     getAcademicCalendar(currentCalendarMonth); // 해당 월의 학사일정 다시 불러오기
                 });
             }

             // 다음 달 버튼 클릭 이벤트 (월별 이동)
             if (nextMonthButton) {
                 nextMonthButton.addEventListener('click', () => {
                     currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + 1); // 달력 월 한 달 증가
                     getAcademicCalendar(currentCalendarMonth); // 해당 월의 학사일정 다시 불러오기
                 });
             }


            // 하단 내비게이션 링크 클릭 시 활성 클래스 업데이트 (링크 이동은 브라우저 기본 동작)
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // 모든 링크에서 active 클래스 제거
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    // 클릭된 링크에 active 클래스 추가
                    link.classList.add('active');

                    // 하단 네비게이션 링크는 현재 1.com으로 이동하도록 설정되어 있습니다.
                    // 만약 섹션 이동 없이 스크롤만 원하시면 e.preventDefault()를 사용하세요.
                    // 예: e.preventDefault(); showSection(link.getAttribute('data-section'));
                    // 현재는 1.com으로 이동하는 것으로 유지합니다.

                     // 클릭 시 마지막 활성 섹션 저장 (1.com 이동 전)
                     const sectionId = link.getAttribute('data-section');
                     localStorage.setItem('lastActiveSection', sectionId);

                });
            });

            // 페이지 로드 시 초기 활성 링크 설정 (로컬 스토리지 또는 기본값 사용)
            const lastActiveSectionId = localStorage.getItem('lastActiveSection') || 'home-section';
            navLinks.forEach(link => {
                 if (link.getAttribute('data-section') === lastActiveSectionId) {
                     link.classList.add('active');
                 } else {
                     link.classList.remove('active');
                 }
            });

            // 보기 전환 버튼 이벤트 리스너
            if (viewToggleButton) {
                viewToggleButton.addEventListener('click', () => {
                    toggleCalendarView();
                });
                // 페이지 로드 시 보기 전환 버튼 텍스트를 기본값에 맞게 설정
                 if (currentView === 'calendar') {
                     viewToggleButton.textContent = '목록 보기';
                 } else {
                     viewToggleButton.textContent = '달력 보기';
                 }
            }

            // 모달 닫기 버튼 이벤트 리스너
            if (modalCloseButton) {
                modalCloseButton.addEventListener('click', () => {
                    hideEventDetailModal();
                });
            }

             // 모달 외부 클릭 시 닫기 이벤트 리스너
             if (eventDetailModal) {
                 eventDetailModal.addEventListener('click', (e) => {
                     // 모달 내용 영역 클릭은 제외
                     if (e.target === eventDetailModal) {
                         hideEventDetailModal();
                     }
                 });
             }
        };

        // 저장된 학년/반 정보를 불러와 입력 필드에 설정하는 함수
        function loadSchoolInfo() {
            const savedGrade = localStorage.getItem('schoolGrade');
            const savedClassNm = localStorage.getItem('schoolClassNm');

            if (savedGrade && savedClassNm) {
                // 저장된 정보가 있으면 입력 필드에 설정
                 const promptGradeInput = document.getElementById('prompt-grade');
                 const promptClassNmInput = document.getElementById('prompt-classNm');
                 if(promptGradeInput) promptGradeInput.value = savedGrade;
                 if(promptClassNmInput) promptClassNmInput.value = savedClassNm;

                 // 학년/반 표시 업데이트 (홈 섹션에만 표시)
                 if(displayGradeSpan) displayGradeSpan.textContent = savedGrade;
                 if(displayClassNmSpan) displayClassNmSpan.textContent = savedClassNm;
            }
        }

        // 학년/반 정보를 저장하고 홈 섹션을 표시하는 함수
        async function saveSchoolInfo() {
            const gradeInput = document.getElementById('prompt-grade');
            const classNmInput = document.getElementById('prompt-classNm');

            if (!gradeInput || !classNmInput) {
                 alert('입력 필드를 찾을 수 없습니다.');
                 return;
            }

            const grade = gradeInput.value;
            const classNm = classNmInput.value;

            if (grade && classNm) {
                localStorage.setItem('schoolGrade', grade);
                localStorage.setItem('schoolClassNm', classNm);

                // 학년/반 표시 업데이트 (홈 섹션에만 표시)
                if(displayGradeSpan) displayGradeSpan.textContent = grade;
                if(displayClassNmSpan) displayClassNmSpan.textContent = classNm;


                showInitialContent(); // 홈 섹션 표시
                 // 정보 저장 후 시간표와 급식 자동 조회
                 // showInitialContent 함수 내에서 날짜 설정 후 호출되도록 변경
            } else {
                alert('학년과 반을 모두 입력해주세요.'); // 간단한 유효성 검사
            }
        }

        // 초기 화면을 표시하는 함수 (저장된 정보 유무에 따라 다름)
        async function showInitialContent() {
            const savedGrade = localStorage.getItem('schoolGrade');
            const savedClassNm = localStorage.getItem('schoolClassNm');

            // 모든 섹션을 기본적으로 숨깁니다.
            contentSections.forEach(section => section.classList.add('hidden'));
             // 초기 프롬프트 섹션도 일단 숨깁니다.
             if(initialPromptSection) initialPromptSection.classList.add('hidden');

            if (savedGrade && savedClassNm) {
                // 정보가 저장되어 있으면 홈 섹션 표시
                if(homeSection) homeSection.classList.remove('hidden');

                 // 페이지 로드 시 자동으로 시간표와 급식을 불러옵니다.
                 const today = new Date();
                 currentDate = today; // 현재 날짜 변수도 업데이트 (일별)
                 currentCalendarMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1); // 달력 월도 현재 월로 초기화

                 updateDateDisplay(today); // 일별 날짜 표시 업데이트
                 setDateInput(today); // 숨겨진 입력 필드 업데이트
                 updateCalendarFacilityInfo(today); // 캘린더 시설 정보 업데이트

                 await getTimetable(); // 시간표 요약 로드 (비동기 대기)
                 getMeals(); // 급식 요약 로드

                 // 기본 보기가 'calendar'이므로 달력 뷰를 표시하고 목록 뷰는 숨깁니다.
                 if (academicCalendarViewDiv) academicCalendarViewDiv.classList.remove('hidden');
                 if (academicCalendarListDiv) academicCalendarListDiv.classList.add('hidden');

                 getAcademicCalendar(currentCalendarMonth); // 학사일정 로드 (기본적으로 달력 뷰 업데이트)
                 // 시간표 로드 후 updateDynamicMessage가 호출되어 메시지 목록 및 타이머 업데이트

            } else {
                // 정보가 없으면 초기 설정 프롬프트 표시
                if(initialPromptSection) initialPromptSection.classList.remove('hidden');
            }
        }


        // 특정 섹션을 보여주고 나머지 섹션을 숨기는 함수 (이제 하단 내비게이션에서는 사용하지 않음)
        // 이 함수는 내부 링크에서 특정 섹션으로 이동할 때 여전히 유용할 수 있습니다.
        function showSection(sectionId) {
             // 초기 프롬프트 섹션은 이 함수에서 제어하지 않음
             if (sectionId !== 'initial-setup-prompt') {
                contentSections.forEach(section => {
                    if (section.id === sectionId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
             }
        }


        // 날짜를 'YYYY년 M월 D일 요일' 형식으로 업데이트하는 함수
        function updateDateDisplay(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1; // getMonth()는 0부터 시작
            const day = date.getDate();
            const dayNames = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
            const dayOfWeek = dayNames[date.getDay()];

            if(currentDateSpan) currentDateSpan.textContent = `${year}년 ${month}월 ${day}일 ${dayOfWeek}`;
        }

        // 숨겨진 날짜 입력 필드에 'YYYYMMDD' 형식으로 날짜를 설정하는 함수
        function setDateInput(date) {
             const year = date.getFullYear();
             const month = ('0' + (date.getMonth() + 1)).slice(-2); // 두 자리로 포맷
             const day = ('0' + date.getDate()).slice(-2); // 두 자리로 포맷
             if(dateInput) dateInput.value = `${year}${month}${day}`;
        }

        // 캘린더 섹션의 시설 정보를 요일에 따라 업데이트하는 함수
        function updateCalendarFacilityInfo(date) {
             const dayOfWeek = date.getDay(); // 요일 (0: 일요일, 1: 월요일, ..., 6: 토요일)
             let facilityInfo = '캘린더에 새로운 일정을 등록 해 보세요'; // 기본 메시지

             switch (dayOfWeek) {
                 case 1: // 월요일
                     facilityInfo = '오늘은 강당 사용일입니다.';
                     break;
                 case 2: // 화요일
                 case 3: // 수요일
                 case 5: // 금요일
                     facilityInfo = '오늘은 탁구장 사용일입니다.';
                     break;
                 case 4: // 목요일
                     facilityInfo = '오늘은 운동장 사용일입니다.';
                     break;
                 // 토요일 (6) 및 일요일 (0)은 기본 메시지 유지
                 default:
                     facilityInfo = '주말/공휴일/방학에는 오늘의 이용시설이 표시되지 않습니다.';
                     break;
             }

             if(calendarFacilityInfoDiv) {
                 calendarFacilityInfoDiv.textContent = facilityInfo;
             }
        }

        // 상단 동적 메시지를 업데이트하고 회전시키는 함수
        function updateDynamicMessage(date) {
            const dayOfWeek = date.getDay(); // 요일 (0: 일요일, 1: 월요일, ..., 6: 토요일)

            if (!dynamicMessageSpan) return; // 메시지 표시 요소가 없으면 종료

            // 표시할 메시지 목록을 초기화합니다.
            dynamicMessages = [];

            // 월요일 메시지 추가
            if (dayOfWeek === 1) {
                dynamicMessages.push('오늘은 아침 체인지 날입니다. 7시 50분까지 등교하세요.');
            }

            // 체육 메시지 추가
            if (hasPE) {
                 dynamicMessages.push('잠깐! 체육복 챙기셨나요?');
            }

            // 기존 타이머가 있다면 중지합니다.
            if (messageInterval) {
                clearInterval(messageInterval);
                messageInterval = null;
            }

            // 메시지 목록의 개수에 따라 표시 방식을 결정합니다.
            if (dynamicMessages.length > 1) {
                // 메시지가 2개 이상이면 회전 타이머를 설정합니다.
                currentMessageIndex = 0; // 인덱스 초기화
                dynamicMessageSpan.textContent = dynamicMessages[currentMessageIndex]; // 첫 번째 메시지 즉시 표시

                messageInterval = setInterval(() => {
                    currentMessageIndex = (currentMessageIndex + 1) % dynamicMessages.length;
                    dynamicMessageSpan.textContent = dynamicMessages[currentMessageIndex];
                }, 5000); // 5초 (5000ms) 간격으로 회전

            } else if (dynamicMessages.length === 1) {
                // 메시지가 1개이면 해당 메시지만 표시합니다.
                dynamicMessageSpan.textContent = dynamicMessages[0];
            } else {
                // 메시지가 없으면 "알림이 없습니다."를 표시합니다.
                dynamicMessageSpan.textContent = '알림이 없습니다.';
            }
        }


        // NEIS API를 사용하여 시간표를 불러오는 함수
        async function getTimetable() {
            // 홈 섹션 요약만 업데이트
            const summaryDiv = document.getElementById("timetable-summary");
            const dateInput = document.getElementById('date');

            if (!summaryDiv) return; // 요약 div가 없으면 함수 종료

            summaryDiv.innerHTML = '<div class="text-gray-400 text-sm">불러오는 중...</div>';
            hasPE = false; // 시간표 불러오기 전에 체육 여부 초기화

            // 저장된 학년과 반 정보를 사용
            const grade = localStorage.getItem('schoolGrade');
            const classNm = localStorage.getItem('schoolClassNm');

             if (!grade || !classNm) {
                 const errorHtml = '<div class="error text-red-400 font-bold text-sm">오류: 학년과 반 정보가 설정되지 않았습니다.</div>';
                 summaryDiv.innerHTML = errorHtml;
                 // 오류 발생 시에도 메시지 업데이트를 위해 hasPE = false 상태로 updateDynamicMessage 호출
                 updateDynamicMessage(currentDate);
                 return;
             }

            // 날짜 입력 필드가 있는지 확인하고 값을 가져옴
            if (!dateInput || !dateInput.value) {
                 const errorHtml = '<div class="error text-red-400 font-bold text-sm">오류: 날짜 정보가 설정되지 않았습니다. 날짜를 선택하거나 페이지를 새로고침해 주세요.</div>';
                 summaryDiv.innerHTML = errorHtml;
                 console.error("Date input element or value is missing.");
                 // 오류 발생 시에도 메시지 업데이트를 위해 hasPE = false 상태로 updateDynamicMessage 호출
                 updateDynamicMessage(currentDate);
                 return;
            }

            const date = dateInput.value;
            console.log("Fetching timetable for date:", date); // Added logging

            // 날짜 유효성 검사 (간단한 예시)
            if (!/^\d{8}$/.test(date)) {
                 const errorHtml = '<div class="error text-red-400 font-bold text-sm">오류: 날짜 형식이 올바르지 않습니다 (YYYYMMDD).</div>';
                 summaryDiv.innerHTML = errorHtml;
                 console.error("Invalid date format:", date); // Added logging
                 // 오류 발생 시에도 메시지 업데이트를 위해 hasPE = false 상태로 updateDynamicMessage 호출
                 updateDynamicMessage(currentDate);
                 return;
            }

            const year = date.substring(0, 4);
            const month = parseInt(date.substring(4, 6), 10);
            // 1학기: 3월 ~ 8월, 2학기: 9월 ~ 2월 (학교마다 다를 수 있음)
            const semester = (month >= 3 && month <= 8) ? 1 : 2;
            // 연도 계산 시 학년도가 아닌 조회 날짜의 연도를 사용
            const schoolYear = year;

            // NEIS API URL (샘플 키와 학교 코드 사용 - 실제 사용 시에는 발급받은 키와 학교 코드를 사용하세요)
            // TODO: 실제 학교 정보로 변경 필요
            const apiKey = "cbb4da48e87445f68c2732368454ebc3"; // 발급받은 인증키로 변경하세요
            const eduCode = "C10"; // 해당 학교의 시도교육청코드로 변경하세요
            const schoolCode = "7171018"; // 해당 학교의 행정표준코드로 변경하세요

            const apiUrl = `https://open.neis.go.kr/hub/misTimetable?KEY=${apiKey}&Type=json&pIndex=1&pSize=100&ATPT_OFCDC_SC_CODE=${eduCode}&SD_SCHUL_CODE=${schoolCode}&AY=${schoolYear}&SEM=${semester}&GRADE=${grade}&CLASS_NM=${classNm}&ALL_TI_YMD=${date}`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                // API 응답 구조 확인 및 데이터 추출
                if (data.misTimetable && data.misTimetable[1] && data.misTimetable[1].row) {
                    const timetable = data.misTimetable[1].row;

                    // 홈 섹션 요약 업데이트
                    if (timetable.length === 0) {
                         summaryDiv.innerHTML = '시간표 데이터가 없습니다.';
                         hasPE = false; // 시간표 없으면 체육 없음
                    } else {
                        // 간단한 목록 형태로 표시
                        let summaryHtml = '';
                        hasPE = false; // 체육 여부 초기화
                         timetable.forEach(period => {
                             summaryHtml += `${period.PERIO}교시: ${period.ITRT_CNTNT}<br>`;
                             // 시간표 내용에 '체육'이 포함되어 있는지 확인
                             if (period.ITRT_CNTNT && (period.ITRT_CNTNT.includes('체육') || period.ITRT_CNTNT.includes('스포츠'))) { // '체육' 또는 '스포츠' 포함 여부 확인
                                 hasPE = true;
                             }
                         });
                         summaryDiv.innerHTML = summaryHtml;
                    }

                } else if (data.RESULT) {
                    // API 오류 메시지 처리
                    const errorMsg = data.RESULT.MESSAGE || "시간표 데이터를 불러오는데 실패했습니다.";
                    const errorHtml = `<div class='error text-red-400 font-bold text-sm'>오류: ${errorMsg}</div>`;
                    summaryDiv.innerHTML = errorHtml;
                    hasPE = false; // 오류 발생 시 체육 없음으로 처리
                }
                else {
                     const errorHtml = '<div class="error text-red-400 font-bold text-sm">시간표 데이터를 찾을 수 없습니다. 응답 구조를 확인하세요.</div>';
                     summaryDiv.innerHTML = errorHtml;
                     hasPE = false; // 데이터 없을 시 체육 없음으로 처리
                }

            } catch (error) {
                console.error("시간표 조회 중 오류 발생:", error);
                const errorHtml = '<div class="error text-red-400 font-bold text-sm">시간표를 불러오는 중 네트워크 오류가 발생했습니다.</div>';
                summaryDiv.innerHTML = errorHtml;
                hasPE = false; // 오류 발생 시 체육 없음으로 처리
            }
             // 시간표 로드 완료 후 동적 메시지 업데이트
             updateDynamicMessage(currentDate);
        }

         // NEIS API를 사용하여 급식 정보를 불러오는 함수
        async function getMeals() {
            // 홈 섹션 요약만 업데이트
            const summaryDiv = document.getElementById("meal-summary");
            const dateInput = document.getElementById('date');

            if (!summaryDiv) return; // 요약 div가 없으면 함수 종료

            summaryDiv.innerHTML = '<div class="text-gray-400 text-sm">불러오는 중...</div>'; // 로딩 메시지 표시


            // 날짜 입력 필드가 있는지 확인하고 값을 가져옴
            if (!dateInput || !dateInput.value) {
                 const errorHtml = '<div class="error text-red-400 font-bold text-sm">오류: 날짜 정보가 설정되지 않았습니다. 날짜를 선택하거나 페이지를 새로고침해 주세요.</div>';
                 summaryDiv.innerHTML = errorHtml;
                 console.error("Date input element or value is missing.");
                 return;
            }

            const date = dateInput.value;
            console.log("Fetching meals for date:", date); // Added logging

            // 날짜 유효성 검사 (YYYYMMDD 형식 확인)
            if (!/^\d{8}$/.test(date)) {
                const errorHtml = '<div class="error text-red-400 font-bold text-sm">오류: 날짜 형식이 올바르지 않습니다 (YYYYMMDD).</div>';
                summaryDiv.innerHTML = errorHtml;
                console.error("Invalid date format:", date); // Added logging
                return;
            }

            // NEIS 급식 정보 API URL
            // TODO: 실제 학교 정보로 변경 필요
            const apiKey = "cbb4da48e87445f68c2732368454ebc3"; // 발급받은 인증키로 변경하세요
            const eduCode = "C10"; // 해당 학교의 시도교육청코드로 변경하세요
            const schoolCode = "7171018"; // 해당 학교의 행정표준코드로 변경하세요

            const apiUrl = `https://open.neis.go.kr/hub/mealServiceDietInfo?KEY=${apiKey}&Type=json&pIndex=1&pSize=100&ATPT_OFCDC_SC_CODE=${eduCode}&SD_SCHUL_CODE=${schoolCode}&MLSV_YMD=${date}`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json(); // 응답을 JSON 형태로 파싱

                // API 응답 구조 확인 및 데이터 추출
                // 'mealServiceDietInfo' 키가 존재하고, 그 안에 데이터 배열이 있는지 확인
                if (data.mealServiceDietInfo && data.mealServiceDietInfo[1] && data.mealServiceDietInfo[1].row) {
                    const meals = data.mealServiceDietInfo[1].row; // 급식 데이터 배열

                    // 홈 섹션 요약 업데이트
                    if (meals.length === 0) {
                         summaryDiv.innerHTML = '등록 된 급식 이 없어 요';
                    } else {
                        let summaryHtml = '';
                         meals.forEach(meal => {
                             // 식사명과 요리명만 간단히 표시
                             const menu = meal.DDISH_NM.replace(/\([^)]*\)/g, '').trim();
                             summaryHtml += `${meal.MMEAL_SC_NM}: ${menu}<br>`;
                         });
                         summaryDiv.innerHTML = summaryHtml;
                    }

                } else if (data.RESULT) {
                    // API 오류 메시지 처리 (예: 데이터 없음, 인증 오류 등)
                    const errorMsg = data.RESULT.MESSAGE || "급식 데이터를 불러오는데 실패했습니다.";
                    const errorHtml = `<div class='error text-red-400 font-bold text-sm'>오류: ${errorMsg}</div>`;
                    summaryDiv.innerHTML = errorHtml;
                }
                 else {
                     // 예상치 못한 응답 구조
                     const errorHtml = '<div class="error text-red-400 font-bold text-sm">급식 데이터를 찾을 수 없습니다. 응답 구조를 확인하세요.</div>';
                     summaryDiv.innerHTML = errorHtml;
                }

            } catch (error) {
                // 네트워크 오류 등 예외 처리
                console.error("급식 조회 중 오류 발생:", error);
                const errorHtml = '<div class="error text-red-400 font-bold text-sm">급식을 불러오는 중 네트워크 오류가 발생했습니다.</div>';
                summaryDiv.innerHTML = errorHtml;
            }
        }

        // NEIS API를 사용하여 학사일정을 불러오는 함수
        // 인자로 표시할 달의 Date 객체를 받도록 수정
        async function getAcademicCalendar(monthDate = currentDate) { // 기본값으로 currentDate 사용 (페이지 로드 시)
            const calendarListDiv = document.getElementById("academic-calendar-list");
            const calendarViewDiv = document.getElementById("academic-calendar-view"); // 달력 뷰 요소 가져옴
            const calendarMonthYearSpan = document.getElementById('calendar-month-year'); // 달력 월/년 표시 요소

            if (!calendarListDiv || !calendarViewDiv || !calendarMonthYearSpan) return; // 학사일정 div 또는 월/년 표시 요소가 없으면 함수 종료

            // 로딩 메시지 표시 (둘 다 업데이트하므로 둘 다 표시)
            // 목록 뷰에 로딩 메시지 표시
            if (currentView === 'list') {
                 calendarListDiv.innerHTML = '<div class="text-gray-400 text-sm">학사일정을 불러오는 중입니다...</div>';
                 // 목록 보기일 때 달력 뷰의 내용을 지웁니다.
                 const existingGrid = calendarViewDiv.querySelector('.calendar-grid');
                 if (existingGrid) {
                     existingGrid.remove();
                 }
            }
            // 달력 뷰는 renderCalendar에서 로딩 메시지를 표시하므로 여기서는 생략


            const year = monthDate.getFullYear();
            const month = monthDate.getMonth(); // 0부터 시작

            // 달력 월/년 표시 업데이트 (목록/달력 공용)
            calendarMonthYearSpan.textContent = `${year}년 ${month + 1}월`;


            // 해당 월의 첫째 날과 마지막 날
            const fromDate = new Date(year, month, 1); // 해당 월의 1일
            const toDate = new Date(year, month + 1, 0); // 해당 월의 마지막 날

            const fromYmd = `${fromDate.getFullYear()}${('0' + (fromDate.getMonth() + 1)).slice(-2)}${('0' + fromDate.getDate()).slice(-2)}`;
            const toYmd = `${toDate.getFullYear()}${('0' + (toDate.getMonth() + 1)).slice(-2)}${('0' + toDate.getDate()).slice(-2)}`;


            // NEIS 학사일정 API URL
            // TODO: 실제 학교 정보로 변경 필요
            const apiKey = "cbb4da48e87445f68c2732368454ebc3"; // 발급받은 인증키로 변경하세요
            const eduCode = "C10"; // 해당 학교의 시도교육청코드로 변경하세요
            const schoolCode = "7171018"; // 해당 학교의 행정표준코드로 변경하세요

            // 기간으로 학사일정을 조회하도록 URL 수정
            const apiUrl = `https://open.neis.go.kr/hub/SchoolSchedule?KEY=${apiKey}&Type=json&pIndex=1&pSize=100&ATPT_OFCDC_SC_CODE=${eduCode}&SD_SCHUL_CODE=${schoolCode}&AA_FROM_YMD=${fromYmd}&AA_TO_YMD=${toYmd}`;

            console.log("Academic Calendar API URL:", apiUrl); // API URL 로깅

            try {
                const response = await fetch(apiUrl);
                const data = await response.json(); // 응답을 JSON 형태로 파싱

                console.log("Academic Calendar API Response:", data); // API 응답 전체 로깅

                let events = []; // 이벤트 데이터를 저장할 배열

                // API 응답 구조 확인 및 데이터 추출
                // 'SchoolSchedule' 키가 존재하고, 그 안에 데이터 배열이 있는지 확인
                if (data.SchoolSchedule && data.SchoolSchedule[1] && data.SchoolSchedule[1].row) {
                    events = data.SchoolSchedule[1].row; // 학사일정 데이터 배열
                    academicCalendarEvents = events; // 불러온 이벤트 데이터를 전역 변수에 저장

                    // 학사일정 목록 업데이트
                    calendarListDiv.innerHTML = ''; // 이전 결과 지우기

                    if (events.length === 0) {
                         calendarListDiv.innerHTML = '<div class="text-gray-400 text-sm">해당 기간의 학사일정이 없습니다.</div>';
                    } else {
                        let eventListHtml = '';
                         // 날짜 순으로 정렬 (AA_YMD 기준)
                         events.sort((a, b) => a.AA_YMD.localeCompare(b.AA_YMD));

                         events.forEach(event => {
                             // 학사일자 (AA_YMD)와 행사명 (EVENT_NM) 표시
                             const eventDate = event.AA_YMD ? `${event.AA_YMD.substring(4, 6)}월 ${event.AA_YMD.substring(6, 8)}일` : '날짜 정보 없음';
                             const eventName = event.EVENT_NM || '행사명 없음';

                             eventListHtml += `
                                <div class="event-item">
                                    <div class="event-date">${eventDate}</div>
                                    <div class="event-name">${eventName}</div>
                                </div>
                            `;
                         });
                         calendarListDiv.innerHTML = eventListHtml; // 결과 영역에 HTML 삽입
                    }

                     // 학사일정 달력 업데이트
                     renderCalendar(events, monthDate); // 달력 뷰 업데이트 (조회한 월의 Date 객체 전달)

                } else if (data.RESULT) {
                    // API 오류 메시지 처리 (예: 데이터 없음, 인증 오류 등)
                    const errorMsg = data.RESULT.MESSAGE || "학사일정 데이터를 불러오는데 실패했습니다.";
                    const errorHtml = `<div class='error text-red-400 font-bold text-sm'>오류: ${errorMsg}</div>`;
                    calendarListDiv.innerHTML = errorHtml;
                    // calendarViewDiv.innerHTML = errorHtml; // 달력 뷰에는 renderCalendar에서 오류 표시
                     console.error("Academic Calendar API Error Result:", data.RESULT); // 오류 결과 로깅
                     renderCalendar([], monthDate); // 오류 시 빈 달력 표시
                     academicCalendarEvents = []; // 이벤트 데이터 초기화
                }
                 else {
                     // 예상치 못한 응답 구조
                     const errorHtml = '<div class="error text-red-400 font-bold text-sm">학사일정 데이터를 찾을 수 없습니다. 응답 구조를 확인하세요.</div>';
                     calendarListDiv.innerHTML = errorHtml;
                     // calendarViewDiv.innerHTML = errorHtml; // 달력 뷰에는 renderCalendar에서 오류 표시
                     console.error("Academic Calendar API Unexpected Response Structure:", data); // 예상치 못한 응답 구조 로깅
                     renderCalendar([], monthDate); // 예상치 못한 응답 시 빈 달력 표시
                     academicCalendarEvents = []; // 이벤트 데이터 초기화
                }

            } catch (error) {
                // 네트워크 오류 등 예외 처리
                console.error("학사일정 조회 중 오류 발생:", error);
                const errorHtml = '<div class="error text-red-400 font-bold text-sm">학사일정을 불러오는 중 네트워크 오류가 발생했습니다.</div>';
                calendarListDiv.innerHTML = errorHtml;
                // calendarViewDiv.innerHTML = errorHtml; // 달력 뷰에는 renderCalendar에서 오류 표시
                renderCalendar([], monthDate); // 네트워크 오류 시 빈 달력 표시
                academicCalendarEvents = []; // 이벤트 데이터 초기화
            }
        }

         // 학사일정 데이터를 기반으로 달력을 생성하고 표시하는 함수
         function renderCalendar(events, date) {
             const calendarViewDiv = document.getElementById("academic-calendar-view");
             if (!calendarViewDiv) return;

             // 기존 달력 내용 중 달력 그리드만 지우고 네비게이션은 유지
             const existingGrid = calendarViewDiv.querySelector('.calendar-grid');
             if (existingGrid) {
                 existingGrid.remove();
             }

             // 달력 로딩 메시지 표시
             calendarViewDiv.insertAdjacentHTML('beforeend', '<div class="text-gray-400 text-sm calendar-loading-message">달력을 불러오는 중입니다...</div>');


             const year = date.getFullYear();
             const month = date.getMonth(); // 0부터 시작

             // 해당 월의 첫째 날과 마지막 날
             const firstDayOfMonth = new Date(year, month, 1);
             const lastDayOfMonth = new Date(year, month + 1, 0);
             const numDaysInMonth = lastDayOfMonth.getDate();

             // 해당 월의 첫째 날의 요일 (0: 일요일, 6: 토요일)
             const firstDayOfWeek = firstDayOfMonth.getDay();

             // 달력 헤더 (요일)와 그리드 시작
             let calendarHtml = '<div class="calendar-grid">';
             const dayNames = ['일', '월', '화', '수', '목', '금', '토'];
             dayNames.forEach(day => {
                 calendarHtml += `<div class="calendar-header">${day}</div>`;
             });

             // 이전 달의 마지막 날짜부터 시작 (달력 첫 행 채우기)
             const prevMonthLastDay = new Date(year, month, 0).getDate();
             for (let i = 0; i < firstDayOfWeek; i++) {
                 const day = prevMonthLastDay - firstDayOfWeek + i + 1;
                 calendarHtml += `<div class="calendar-day"><div class="day-number text-gray-600">${day}</div></div>`; // 이전 달 날짜는 흐리게
             }

             // 현재 달 날짜 채우기
             for (let day = 1; day <= numDaysInMonth; day++) {
                 const currentDay = new Date(year, month, day);
                 const currentDayYmd = `${year}${('0' + (month + 1)).slice(-2)}${('0' + day).slice(-2)}`;

                 // 해당 날짜의 이벤트 찾기
                 const dayEvents = events.filter(event => event.AA_YMD === currentDayYmd);

                 let eventIndicatorHtml = '';
                 let tooltipHtml = '';

                 if (dayEvents.length > 0) {
                     // 이벤트가 있으면 첫 번째 이벤트 표시 및 툴팁 내용 생성
                     // 모바일에서 잘리지 않도록 word-break: break-word 스타일 추가
                     eventIndicatorHtml = `<div class="event-indicator" style="word-break: break-word;">${dayEvents[0].EVENT_NM || '이벤트'}</div>`;

                     tooltipHtml = `<div class="event-tooltip"><div class="tooltip-date">${(month + 1)}월 ${day}일</div>`;
                     dayEvents.forEach(event => {
                         tooltipHtml += `<div class="tooltip-event">- ${event.EVENT_NM || '행사명 없음'}</div>`;
                     });
                     tooltipHtml += '</div>';
                 }

                 // 오늘 날짜 강조
                 const today = new Date();
                 const isToday = currentDay.getFullYear() === today.getFullYear() &&
                                 currentDay.getMonth() === today.getMonth() &&
                                 currentDay.getDate() === today.getDate();

                 // 이벤트가 있는 날짜에 data-date 속성 추가
                 const dayClass = `calendar-day current-month ${dayEvents.length > 0 ? 'has-event' : ''} ${isToday ? 'border-2 border-blue-500' : ''}`; // 오늘 날짜에 테두리 추가
                 const dataAttributes = dayEvents.length > 0 ? `data-date="${currentDayYmd}"` : ''; // 이벤트가 있는 날짜에만 data-date 추가


                 calendarHtml += `
                     <div class="${dayClass}" ${dataAttributes}>
                         <div class="day-number">${day}</div>
                         ${eventIndicatorHtml}
                         ${tooltipHtml}
                     </div>
                 `;
             }

             // 다음 달의 첫 날부터 채우기 (달력 마지막 행 채우기)
             const totalCells = firstDayOfWeek + numDaysInMonth;
             const cellsInLastRow = totalCells % 7;
             const nextMonthStartFiller = cellsInLastRow === 0 ? 0 : 7 - cellsInLastRow;


             for (let i = 1; i <= nextMonthStartFiller; i++) {
                 calendarHtml += `<div class="calendar-day"><div class="day-number text-gray-600">${i}</div></div>`; // 다음 달 날짜는 흐리게
             }


             calendarHtml += '</div>'; // calendar-grid 닫기

             // 달력 그리드를 달력 뷰 div에 추가 (네비게이션 아래에 위치)
             calendarViewDiv.insertAdjacentHTML('beforeend', calendarHtml);

             // 로딩 메시지 제거
             const loadingMessage = calendarViewDiv.querySelector('.calendar-loading-message');
             if (loadingMessage) {
                 loadingMessage.remove();
             }

             // 이벤트가 있는 날짜 셀에 클릭 이벤트 리스너 추가
             calendarViewDiv.querySelectorAll('.calendar-day.has-event').forEach(dayElement => {
                 dayElement.addEventListener('click', () => {
                     const dateYmd = dayElement.getAttribute('data-date');
                     if (dateYmd) {
                         showEventDetailModal(dateYmd);
                     }
                 });
             });
         }

         // 특정 날짜의 상세 일정을 모달로 표시하는 함수
         function showEventDetailModal(dateYmd) {
             if (!eventDetailModal || !modalDateTitle || !modalEventList || !academicCalendarEvents) return;

             // 해당 날짜의 이벤트 필터링
             const dayEvents = academicCalendarEvents.filter(event => event.AA_YMD === dateYmd);

             // 모달 제목 설정
             const year = dateYmd.substring(0, 4);
             const month = parseInt(dateYmd.substring(4, 6), 10);
             const day = parseInt(dateYmd.substring(6, 8), 10);
             const date = new Date(year, month - 1, day);
             const dayNames = ['일', '월', '화', '수', '목', '금', '토'];
             const dayOfWeek = dayNames[date.getDay()];
             modalDateTitle.textContent = `${month}월 ${day}일 (${dayOfWeek})`;

             // 모달 내용 (이벤트 목록) 설정
             modalEventList.innerHTML = ''; // 이전 내용 지우기
             if (dayEvents.length > 0) {
                 dayEvents.forEach(event => {
                     const eventName = event.EVENT_NM || '행사명 없음';
                     modalEventList.innerHTML += `
                         <div class="modal-event-item">
                             <div class="modal-event-name">${eventName}</div>
                         </div>
                     `;
                 });
             } else {
                 modalEventList.innerHTML = '<div class="text-gray-400 text-sm">해당 날짜의 일정이 없습니다.</div>';
             }

             // 모달 표시
             eventDetailModal.classList.remove('hidden');
         }

         // 상세 일정 모달을 숨기는 함수
         function hideEventDetailModal() {
             if (eventDetailModal) {
                 eventDetailModal.classList.add('hidden');
             }
         }


         // 달력/목록 보기 전환 함수
         function toggleCalendarView() {
             const calendarListDiv = document.getElementById("academic-calendar-list");
             const calendarViewDiv = document.getElementById("academic-calendar-view");
             const viewToggleButton = document.getElementById('view-toggle');

             if (!calendarListDiv || !calendarViewDiv || !viewToggleButton) return;

             if (currentView === 'list') {
                 // 목록 보기 -> 달력 보기로 전환
                 calendarListDiv.classList.add('hidden');
                 calendarViewDiv.classList.remove('hidden');
                 viewToggleButton.textContent = '목록 보기';
                 currentView = 'calendar';
                  // 달력 보기로 전환 시 현재 달력 월 기준으로 학사일정 다시 불러오기
                 getAcademicCalendar(currentCalendarMonth);
             } else {
                 // 달력 보기 -> 목록 보기로 전환
                 calendarViewDiv.classList.add('hidden');
                 calendarListDiv.classList.remove('hidden');
                 viewToggleButton.textContent = '달력 보기';
                 currentView = 'list';
                  // 목록 보기로 전환 시 현재 달력 월 기준으로 학사일정 다시 불러오기
                 getAcademicCalendar(currentCalendarMonth); // 목록 보기 시에도 currentCalendarMonth 기준
             }
         }


    </script>
</body>
</html>
